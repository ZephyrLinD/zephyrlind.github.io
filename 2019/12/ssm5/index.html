<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>SSM框架学习笔记（五） 面向切面开发（AOP） | 梦黎的小窝</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noodp" />
<meta name="Description" content="一个程序员的自留地">
<link rel="prev" href="https://blog.z36.moe/2019/12/ssm4/" />
<link rel="next" href="https://blog.z36.moe/2019/12/ssm6/" />
<link rel="canonical" href="https://blog.z36.moe/2019/12/ssm5/" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SSM框架学习笔记（五） 面向切面开发（AOP）"/>
<meta name="twitter:description" content="面向切面的开发（AOP）"/>
<script type="application/ld+json">
    {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "SSM框架学习笔记（五） 面向切面开发（AOP）",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https:\/\/blog.z36.moe\/2019\/12\/ssm5\/"
    },
    
        "image": {
            "@type": "ImageObject",
            "url": "https:\/\/blog.z36.moe\/cover.png",
            "width":  800 ,
            "height":  600 
        },
    
    "genre": "posts",
    
        "keywords": "学习笔记, Java, 后端开发笔记, Spring, Spring MVC, MyBatics, Java SSM企业课",
    
    "wordcount":  1777 ,
    "url": "https:\/\/blog.z36.moe\/2019\/12\/ssm5\/",
    
        "datePublished": "2019-12-19T16:21:59\u002b08:00",
    
    
        "dateModified": "2019-12-19T16:21:59\u002b08:00",
    
    
        "license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.",
    
    
        "publisher": {
            "@type": "Organization",
            "name": "Zephyr",
            "logo": {
            "@type": "ImageObject",
            "url": "https:\/\/blog.z36.moe\/logo.png",
            "width":  127 ,
            "height":  40 
            }
        },
    
    
    "description": ""
    }
    </script>
<link rel="stylesheet" href="/css/style.min.css">
<link rel="stylesheet" href="/css/lib/fontawesome-free/all.min.min.css">

<link rel="stylesheet" href="/css/lib/animate/animate.min.min.css">

    </head>
    <body>
        <script>
            window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            window.isDark && document.body.classList.add('dark-theme');
        </script>
        <div class="wrapper">
            <nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-header animated bounceIn">
            <a href="https://blog.z36.moe/">梦黎的小窝</a>
        </div>
        <div class="navbar-menu">
            
            
                <a class="menu-item" href="https://blog.z36.moe/posts" title="">文章</a>
            
                <a class="menu-item" href="https://blog.z36.moe/tags" title="">标签</a>
            
                <a class="menu-item" href="https://blog.z36.moe/categories" title="">分类</a>
            
                <a class="menu-item" href="https://blog.z36.moe/about" title="">关于我</a>
            
            <a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a>
        </div>
    </div>
</nav>
<nav class="navbar-mobile">
     <div class="navbar-container">
        <div class="navbar-header">
            <div class="navbar-header-title animated bounceIn">
                <a href="https://blog.z36.moe/">梦黎的小窝</a>
            </div>
            <div class="menu-toggle" id="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="navbar-menu" id="mobile-menu">
            
            
                <a class="menu-item" href="https://blog.z36.moe/posts" title="">文章</a>
            
                <a class="menu-item" href="https://blog.z36.moe/tags" title="">标签</a>
            
                <a class="menu-item" href="https://blog.z36.moe/categories" title="">分类</a>
            
                <a class="menu-item" href="https://blog.z36.moe/about" title="">关于我</a>
            
            <a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a>
        </div>
    </div>
</nav><main class="main">
                <div class="container">
                    
    
    
    

    <article class="post-warp">
        <h1 class="post-title animated flipInX">SSM框架学习笔记（五） 面向切面开发（AOP）</h1>

        <div class="post-meta">
            <div class="post-meta-main">
                <a class="author" href="https://blog.z36.moe/" rel="author"><i class="fas fa-user-circle fa-fw"></i>Zephyr&nbsp;</a>
                <span class="post-category">
                        收录于
                        <i class="far fa-folder fa-fw"></i><a href="https://blog.z36.moe/categories/ssm%E6%A1%86%E6%9E%B6/">SSM框架</a>
                            <i class="far fa-folder fa-fw"></i><a href="https://blog.z36.moe/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">后端开发</a>
                            
                    </span>
            </div>
            <div class="post-meta-other">
                <i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-12-19>2019-12-19</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>约 1777 字&nbsp;
                <i class="far fa-clock fa-fw"></i>预计阅读 4 分钟&nbsp;</div>
        </div>

        

        

        <div class="post-content">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="post-dummy-target" id="aop-中的术语"></a><h2>AOP 中的术语</h2>
<ul>
<li>Joinpoint(连接点):所谓连接点是指那些被拦截到的点。在 spring 中,这些点指的是方法,因为 spring 只支持方法类型的连接点.</li>
<li>Pointcut(切入点):所谓切入点是指我们要对哪些 Joinpoint 进行拦截的定义.</li>
<li>Advice(通知/增强):所谓通知是指拦截到 Joinpoint 之后所要做的事情就是通知.通知分为前置通知,后置通知,异常通知,最终通知,环绕通知(切面要完成的功能)</li>
<li>Introduction(引介):引介是一种特殊的通知在不修改类代码的前提下, Introduction 可以在运行期为类</li>
<li>动态地添加一些方法或 Field.</li>
<li>Target(目标对象):代理的目标对象</li>
<li>Weaving(织入):是指把增强应用到目标对象来创建新的代理对象的过程.</li>
<li>spring 采用动态代理织入，而 AspectJ 采用编译期织入和类装在期织入</li>
<li>Proxy（代理） :一个类被 AOP 织入增强后，就产生一个结果代理类</li>
<li>Aspect(切面): 是切入点和通知（引介）的结合</li>
</ul>
<a class="post-dummy-target" id="需要导的-jar-包"></a><h2>需要导的 Jar 包</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- spring 的传统 AOP 的开发的包 --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-aop<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>4.3.19.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="c">&lt;!-- aspectJ 的开发包: --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-aspects<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>4.3.19.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="引入-spring-的配置文件引入-aop-约束"></a><h2>引入 Spring 的配置文件，引入 AOP 约束</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- spring.xml --&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
<span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
<span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
<span class="na">xsi:schemaLocation=</span><span class="s">&#34;
</span><span class="s">http://www.springframework.org/schema/beans
</span><span class="s">http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">http://www.springframework.org/schema/aop
</span><span class="s">http://www.springframework.org/schema/aop/spring-aop.xsd&#34;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="编写目标类"></a><h2>编写目标类</h2>
<a class="post-dummy-target" id="编写接口"></a><h3>编写接口</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">co.zephyrl.dao</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserDao</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">find</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">();</span>
    <span class="kt">int</span> <span class="nf">delete</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="编写目标类对象"></a><h3>编写目标类对象</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">co.zephyrl.dao</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoImpl</span> <span class="kd">implements</span> <span class="n">UserDao</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">find</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;查找用户&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;保存&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;更新&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">delete</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;删除&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">1</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="目标类的配置"></a><h2>目标类的配置</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- spring.xml --&gt;</span>
<span class="c">&lt;!-- 这个bean填写目标类的信息 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;userDao&#34;</span> <span class="na">class=</span><span class="s">&#34;co.zephyrl.dao.UserDaoImpl&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="通知类型"></a><h2>通知类型</h2>
<ul>
<li>前置通知 ：在目标方法执行之前执行.</li>
<li>后置通知 ：在目标方法执行之后执行</li>
<li>环绕通知 ：在目标方法执行前和执行后执行</li>
<li>异常抛出通知：在目标方法执行出现异常的时候执行</li>
<li>最终通知 ：无论目标方法是否出现异常最终通知都会执行</li>
</ul>
<a class="post-dummy-target" id="切入点表达式"></a><h2>切入点表达式</h2>
<p><code>execution</code> 主要用在 spring.xml 配置文件中。</p>
<a class="post-dummy-target" id="executionexpressions"></a><h3><code>execution([expressions])</code></h3>
<ul>
<li>*：匹配任何数量字符；</li>
<li>..：匹配任何数量字符的重复，如在类型模式中匹配任何数量子包；而在方法参数模式中匹配任何数量参数。</li>
<li>+：匹配指定类型的子类型；仅能作为后缀放在类型模式后边。</li>
</ul>
<a class="post-dummy-target" id="表达式格式"></a><h3>表达式格式</h3>
<table>
<thead>
<tr>
<th align="center">表达式</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">public * com.itdr.dao.*.*(..)</td>
<td align="center">任意返回值类型，dao包下的任意类的任意方法都会被增强</td>
</tr>
<tr>
<td align="center">* com.itdr.dao.*.*(..)</td>
<td align="center">任意修饰符，任意返回值类型，dao包下的任意类的任意方法都会被增强</td>
</tr>
<tr>
<td align="center">* com.itdr.dao.UserDao+.*(..)</td>
<td align="center">表示当前类和它的子类的所有方法都会被增强</td>
</tr>
<tr>
<td align="center">* com.itdr.dao..*.*(..)</td>
<td align="center">任意修饰符，任意返回值类型，dao包及其子包下的下的任意类的任意方法都会被增强</td>
</tr>
</tbody>
</table>
<a class="post-dummy-target" id="编写一个切面类"></a><h2>编写一个切面类</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- 配置切面类 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;aopDemo&#34;</span> <span class="na">class=</span><span class="s">&#34;co.zephyrl.dao.AopDemo&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>

<span class="c">&lt;!-- 进行AOP设置 --&gt;</span>
<span class="nt">&lt;aop:config&gt;</span>
    <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">&#34;p1&#34;</span> <span class="na">expression=</span><span class="s">&#34;execution(* co.zephyrl.dao.UserDao.save(..))&#34;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">&#34;p2&#34;</span> <span class="na">expression=</span><span class="s">&#34;execution(* co.zephyrl.dao.UserDao.delete(..))&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">&#34;p3&#34;</span> <span class="na">expression=</span><span class="s">&#34;execution(* co.zephyrl.dao.UserDao.update(..))&#34;</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--配置切面--&gt;</span>
    <span class="nt">&lt;aop:aspect</span> <span class="na">ref=</span><span class="s">&#34;aopDemo&#34;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- 配置前置通知指向切面中的方法，切入点指向p1 --&gt;</span>
        <span class="nt">&lt;aop:before</span> <span class="na">method=</span><span class="s">&#34;before&#34;</span> <span class="na">pointcut-ref=</span><span class="s">&#34;p1&#34;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- 配置后置通知指向切面中的删除方法，切入点指向p2 --&gt;</span>
        <span class="nt">&lt;aop:after-returning</span> <span class="na">method=</span><span class="s">&#34;af&#34;</span> <span class="na">pointcut-ref=</span><span class="s">&#34;p2&#34;</span> <span class="na">returning=</span><span class="s">&#34;num&#34;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- 配置环绕通知指向切面中的修改方法，切入点指向p3 --&gt;</span>
        <span class="nt">&lt;aop:around</span> <span class="na">method=</span><span class="s">&#34;ar&#34;</span> <span class="na">pointcut-ref=</span><span class="s">&#34;p3&#34;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- 配置异常通知指向切面中的修改方法，切入点指向p3 --&gt;</span>
        <span class="nt">&lt;aop:after-throwing</span> <span class="na">method=</span><span class="s">&#34;th&#34;</span> <span class="na">pointcut-ref=</span><span class="s">&#34;p3&#34;</span> <span class="na">throwing=</span><span class="s">&#34;thr&#34;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- 配置最终通知指向切面中的修改方法，切入点指向p3 --&gt;</span>
        <span class="nt">&lt;aop:after</span> <span class="na">method=</span><span class="s">&#34;zz&#34;</span> <span class="na">pointcut-ref=</span><span class="s">&#34;p3&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/aop:aspect&gt;</span>
<span class="nt">&lt;/aop:config&gt;</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="测试"></a><h2>测试</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDemo</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">demo1</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">ApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&#34;spring.xml&#34;</span><span class="o">);</span>
        <span class="n">UserDao</span> <span class="n">userDao</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;userDao&#34;</span><span class="o">,</span> <span class="n">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">userDao</span><span class="o">.</span><span class="na">find</span><span class="o">();</span>
        <span class="n">userDao</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
        <span class="n">userDao</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
        <span class="n">userDao</span><span class="o">.</span><span class="na">update</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="aop-底层原理了解"></a><h2>AOP 底层原理（了解）</h2>
<p>AOP的底层原理是<strong>动态代理</strong>技术，而动态代理技术的底层原理是是<strong>反射</strong></p>
<p>下面我们来使用 JDK 动态代理增强一个类中方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyJDKProxy</span> <span class="kd">implements</span> <span class="n">InvocationHandler</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">UserDao</span> <span class="n">userDao</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MyJDKProxy</span><span class="o">(</span><span class="n">UserDao</span> <span class="n">userDao</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userDao</span> <span class="o">=</span> <span class="n">userDao</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// 编写工具方法：生成代理
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">UserDao</span> <span class="nf">createProxy</span><span class="o">(){</span>
        <span class="n">UserDao</span> <span class="n">userDaoProxy</span> <span class="o">=</span> <span class="o">(</span><span class="n">UserDao</span><span class="o">)</span>
        <span class="c1">// 获取字节码
</span><span class="c1"></span>        <span class="n">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">userDao</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">(),</span>
        <span class="n">userDao</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getInterfaces</span><span class="o">(),</span> <span class="k">this</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">userDaoProxy</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="s">&#34;save&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">())){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;权限校验================&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">userDao</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>进行单元测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">UserDao</span> <span class="n">ud</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JDBCUserDaoImpl</span><span class="o">();</span>
    <span class="n">ud</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
    <span class="c1">// 代理
</span><span class="c1"></span>    <span class="n">UserDao</span> <span class="n">udProxy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JDKProxy</span><span class="o">(</span><span class="n">ud</span><span class="o">).</span><span class="na">createProxy</span><span class="o">;</span>
    <span class="n">udProxy</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>除此之外我们还可以用 Cglib 动态代理增强一个类中的方法:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCglibProxy</span> <span class="kd">implements</span> <span class="n">MethodInterceptor</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">CustomerDao</span> <span class="n">customerDao</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MyCglibProxy</span><span class="o">(</span><span class="n">CustomerDao</span> <span class="n">customerDao</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">customerDao</span> <span class="o">=</span> <span class="n">customerDao</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// 生成代理的方法:
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">CustomerDao</span> <span class="nf">createProxy</span><span class="o">(){</span>
        <span class="c1">// 创建 Cglib 的核心类:
</span><span class="c1"></span>        <span class="n">Enhancer</span> <span class="n">enhancer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Enhancer</span><span class="o">();</span>
        <span class="c1">// 设置父类:
</span><span class="c1"></span>        <span class="n">enhancer</span><span class="o">.</span><span class="na">setSuperclass</span><span class="o">(</span><span class="n">CustomerDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="c1">// 设置回调:
</span><span class="c1"></span>        <span class="n">enhancer</span><span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="c1">// 生成代理：
</span><span class="c1"></span>        <span class="n">CustomerDao</span> <span class="n">customerDaoProxy</span> <span class="o">=</span> <span class="o">(</span><span class="n">CustomerDao</span><span class="o">)</span> <span class="n">enhancer</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">customerDaoProxy</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">intercept</span><span class="o">(</span><span class="n">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">,</span> <span class="n">MethodProxy</span> <span class="n">methodProxy</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="s">&#34;delete&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">())){</span>
            <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">methodProxy</span><span class="o">.</span><span class="na">invokeSuper</span><span class="o">(</span><span class="n">proxy</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;日志记录================&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">methodProxy</span><span class="o">.</span><span class="na">invokeSuper</span><span class="o">(</span><span class="n">proxy</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div>
        </div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>本文于 2019-12-19 更新</span>
            </div>
            <div class="post-info-license">
                
            </div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md">
                
                    
                        <span><a class="link-to-markdown" href="https://blog.z36.moe/2019/12/ssm5/index.md" target="_blank">阅读原始文档</a></span>
                    
                
            </div>
            <div class="post-info-share">
                
                    <span>
    
        <a href="//twitter.com/share?url=https%3a%2f%2fblog.z36.moe%2f2019%2f12%2fssm5%2f&amp;text=SSM%e6%a1%86%e6%9e%b6%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e4%ba%94%ef%bc%89%20%e9%9d%a2%e5%90%91%e5%88%87%e9%9d%a2%e5%bc%80%e5%8f%91%ef%bc%88AOP%ef%bc%89&amp;via=z361in" target="_blank" title="Share on Twitter">
            <i class="fab fa-twitter fa-fw"></i>
        </a>
    
    
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.z36.moe%2f2019%2f12%2fssm5%2f" target="_blank" title="Share on Facebook">
            <i class="fab fa-facebook-square fa-fw"></i>
        </a>
    
    
        <a href="//reddit.com/submit?url=https%3a%2f%2fblog.z36.moe%2f2019%2f12%2fssm5%2f&amp;title=SSM%e6%a1%86%e6%9e%b6%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e4%ba%94%ef%bc%89%20%e9%9d%a2%e5%90%91%e5%88%87%e9%9d%a2%e5%bc%80%e5%8f%91%ef%bc%88AOP%ef%bc%89" target="_blank" title="Share on Reddit">
            <i class="fab fa-reddit fa-fw"></i>
        </a>
    
    
    
    
    
    
    
    
</span>
                
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section>
            
                
                    <span class="tag">
                        <a href="https://blog.z36.moe/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="fas fa-tag fa-fw"></i>学习笔记</a>
                    </span>
                
                    <span class="tag">
                        <a href="https://blog.z36.moe/tags/java/"><i class="fas fa-tag fa-fw"></i>Java</a>
                    </span>
                
                    <span class="tag">
                        <a href="https://blog.z36.moe/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/"><i class="fas fa-tag fa-fw"></i>后端开发笔记</a>
                    </span>
                
                    <span class="tag">
                        <a href="https://blog.z36.moe/tags/spring/"><i class="fas fa-tag fa-fw"></i>Spring</a>
                    </span>
                
                    <span class="tag">
                        <a href="https://blog.z36.moe/tags/spring-mvc/"><i class="fas fa-tag fa-fw"></i>Spring MVC</a>
                    </span>
                
                    <span class="tag">
                        <a href="https://blog.z36.moe/tags/mybatics/"><i class="fas fa-tag fa-fw"></i>MyBatics</a>
                    </span>
                
                    <span class="tag">
                        <a href="https://blog.z36.moe/tags/java-ssm%E4%BC%81%E4%B8%9A%E8%AF%BE/"><i class="fas fa-tag fa-fw"></i>Java SSM企业课</a>
                    </span>
                
            
        </section>
        <section>
            <span><a href="javascript:window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="https://blog.z36.moe/">主页</a></span>
        </section>
    </div>

    <div class="post-nav">
        
            <a href="https://blog.z36.moe/2019/12/ssm4/" class="prev" rel="prev" title="SSM框架学习笔记（四） 整合JDBC"><i class="fas fa-angle-left fa-fw"></i>SSM框架学习笔记（四） 整合JDBC</a>
        
        
            <a href="https://blog.z36.moe/2019/12/ssm6/" class="next" rel="next" title="SSM框架学习笔记（六） 事务">SSM框架学习笔记（六） 事务<i class="fas fa-angle-right fa-fw"></i></a>
        
    </div>
</div>

        <div class="post-comment">
            
            

            
        </div>
    </article></div>
            </main>
            <footer class="footer">
    <div class="copyright">
        <div class="copyright-line">
            由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a>
        </div>
        <div class="copyright-line">
            <i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2017 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.z36.moe/">Zephyr</a></span><span class="license">&nbsp;|&nbsp;<a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer>


    
    




    
    




    
    





    
    



    
    



    
    





    
    





    
    



    
    





    
    




    
    




    
    



    
    





    
    


<script src="/js/lib/jquery/jquery.slim.min.min.js"></script>
<script src="/js/lib/lazysizes/lazysizes.min.min.js"></script>
<script src="/js/lib/smooth-scroll/smooth-scroll.polyfills.min.min.js"></script><script>window.scroll = new SmoothScroll('[data-scroll]', {speed: 300, speedAsDuration: true});</script>


    
    

    

    

    

    






<script src="/js/blog.min.js"></script>


    
</div>
        <a href="#" class="dynamic-to-top" id="dynamic-to-top" data-scroll><span>&nbsp;</span></a>
    </body>
</html>